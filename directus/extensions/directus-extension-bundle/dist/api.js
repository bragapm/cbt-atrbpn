import e from"crypto";function t(){return e.randomBytes(16)}for(var a=[],r=0;r<256;++r)a[r]=(r+256).toString(16).substr(1);function o(e,r,o){var n=r&&o||0;"string"==typeof e&&(r="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||t)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,r)for(var c=0;c<16;++c)r[n+c]=s[c];return r||function(e,t){var r=t||0,o=a;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}(s)}const n=[],s=[{name:"hello",config:e=>{e.get("/",((e,t)=>t.send("Hello, World!")))}},{name:"coupon",config:(e,{services:t,exceptions:a,getSchema:r})=>{const{UsersService:n,ItemsService:s,AuthenticationService:c}=t;e.post("/register",(async(e,t)=>{try{const{coupon_code:a}=e.body,i=`user_${o()}@example.com`,l="CBTATRBPN2024",u=new n({schema:await r()}),d=await u.createOne({email:i,password:l,status:"active"}),m=new s("coupon",{schema:await r()}),w=new Date;await m.createOne({code:a,user_id:d,status:"Published",created_at:w,updated_at:w,last_login_at:w});const p=new c({accountability:null,schema:await r()}),g=await p.login(void 0,{email:i,password:l});t.json({status:"succes",data:{email:i,password:l,last_login_at:d.last_login_at,access_token:g.accessToken,refresh_token:g.refreshToken}})}catch(e){console.error(e),t.json({status:"error",error:new Error(e).message})}}))}}],c=[];export{s as endpoints,n as hooks,c as operations};
