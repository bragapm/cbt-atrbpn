import e from"crypto";function o(){return e.randomBytes(16)}for(var t=[],a=0;a<256;++a)t[a]=(a+256).toString(16).substr(1);function r(e,a,r){var n=a&&r||0;"string"==typeof e&&(a="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,a)for(var c=0;c<16;++c)a[n+c]=s[c];return a||function(e,o){var a=o||0,r=t;return[r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],"-",r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]],r[e[a++]]].join("")}(s)}const n=[],s=[{name:"hello",config:e=>{e.get("/",((e,o)=>o.send("Hello, World!")))}},{name:"coupon",config:(e,{services:o,exceptions:t,getSchema:a})=>{const{UsersService:n,ItemsService:s,AuthenticationService:c}=o;e.post("/register",(async(e,o,t)=>{try{const{coupon_code:t}=e.body,i=`user_${r()}@example.com`,l="CBTATRBPN2024",u=new n({schema:await a()}),g=await u.createOne({email:i,password:l,status:"active"}),d=new s("coupon",{schema:await a()}),m=new Date,p=(await d.createOne({code:t,user_id:g,status:"Published",created_at:m,updated_at:m,last_login_at:m}),new c({accountability:null,schema:await a()}));console.log({authService:p}),console.log("Attempting login with:",{email:i,password:l});const w=await p.login(void 0,{email:i,password:l});console.log("authdata",w),o.json({email:i,password:l,last_login_at:g.last_login_at,access_token:w.accessToken,refresh_token:w.refreshToken})}catch(e){console.error("Error creating user or coupon:",e),t(new Error(`Error creating user or coupon: ${e.message}`))}})),e.get("/",(async(e,o)=>o.json({status:"success",data:"Hello"})))}}],c=[];export{s as endpoints,n as hooks,c as operations};
